<h1 id="broadcast">Broadcast</h1>

<p>A plugin for Reveal.js allowing to broadcast audio and video for slide shows.</p>

<p><a href="https://rajgoel.github.io/reveal.js-demos/broadcast-demo.html">Check out the live demo</a></p>

<h2 id="installation">Installation</h2>

<p>Copy the files of the plugin next to your reveal.js presentation and add the dependencies as below.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Reveal</span><span class="p">.</span><span class="nx">initialize</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">dependencies</span><span class="p">:</span> <span class="p">[</span>
    <span class="c1">// ... </span>
    <span class="p">{</span> <span class="na">src</span><span class="p">:</span> <span class="s1">'../reveal.js-plugins/broadcast/RTCMultiConnection.min.js'</span><span class="p">},</span>
    <span class="p">{</span> <span class="na">src</span><span class="p">:</span> <span class="s1">'../reveal.js-plugins/broadcast/socket.io.js'</span><span class="p">},</span>
    <span class="p">{</span> <span class="na">src</span><span class="p">:</span> <span class="s1">'../reveal.js-plugins/broadcast/bCrypt.js'</span><span class="p">},</span>
    <span class="p">{</span> <span class="na">src</span><span class="p">:</span> <span class="s1">'../reveal.js-plugins/broadcast/broadcast.js'</span><span class="p">},</span>
    <span class="c1">// ... </span>
  <span class="p">]</span>
<span class="p">});</span>
</code></pre></div></div>
<h2 id="configuration">Configuration</h2>

<p>You can configure the <code class="highlighter-rouge">broadcast.js</code> plugin by providing a <code class="highlighter-rouge">broadcast</code> option in the reveal.js initialization options.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Reveal</span><span class="p">.</span><span class="nx">initialize</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">broadcast</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Set master password to "123456"</span>
    <span class="na">secret</span><span class="p">:</span> <span class="s1">'$2a$05$hhgakVn1DWBfgfSwMihABeYToIBEiQGJ.ONa.HWEiNGNI6mxFCy8S'</span><span class="p">,</span> 
    <span class="c1">// Configure RTCMultiConnection</span>
    <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">socketURL</span><span class="p">:</span> <span class="s1">'https://revealjs-broadcast.herokuapp.com/'</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div></div>
<p>The parameter <code class="highlighter-rouge">secret</code> is a hash for the password which has to be provided when starting a broadcast. You can generate this secret with <a href="https://rajgoel.github.io/reveal.js-plugins/broadcast/generatehash.html"><code class="highlighter-rouge">generatehash.html</code></a>. The parameter <code class="highlighter-rouge">connection</code> provides the configuration for RTCMultiConnection as described in the <a href="https://github.com/muaz-khan/RTCMultiConnection/blob/master/docs/api.md">API Reference</a>. The only required option is the parameter <code class="highlighter-rouge">socketURL</code>. For testing purposes you may use the server <code class="highlighter-rouge">https://revealjs-broadcast.herokuapp.com/</code>, but availability and stability are not guaranteed. For anything mission critical I recommend you run your own server. For example, you can deploy https://github.com/muaz-khan/RTCMultiConnection on <a href="https://www.heroku.com/">Heroku</a> using this <a href="https://github.com/muaz-khan/RTCMultiConnection/blob/master/docs/installation-guide.md">Installation Guide</a>. The only change required to <code class="highlighter-rouge">server.js</code> is to set <code class="highlighter-rouge">isUseHTTPs = true;</code></p>

<h2 id="start-broadcast">Start broadcast</h2>

<p>To start a broadcast you can include a button in the slideshow which calls the function <code class="highlighter-rouge">RevealBroadcast.start</code> with the  broadcast id and the master password.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"broadcastid"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"RevealBroadcast.start( { id: document.getElementById('broadcastid').value, password: document.getElementById('password').value } ); return false;"</span><span class="nt">&gt;</span>Start broadcast<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>
<p>After clicking the <code class="highlighter-rouge">Start broadcast</code> button, a draggable overlay for the video is shown. Initially, the video shows a snowy image. After connecting to the server and after the user has allowed acces to camera and microphone, the video captured by the camera is shown.</p>

<h2 id="join-broadcast">Join broadcast</h2>

<p>To join a broadcast you can include a button in the slideshow which calls the function <code class="highlighter-rouge">RevealBroadcast.connect</code> with the  broadcast id.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"broadcastid"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"RevealBroadcast.connect( { id: document.getElementById('broadcastid').value } ); return false;"</span><span class="nt">&gt;</span>Join broadcast<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>
<p>After clicking the <code class="highlighter-rouge">Join broadcast</code> button, a draggable overlay for the video is shown. Initially, the video shows a snowy image. After connecting to the server, the client receives audio and video of the master and the slides are updated whith every update by the master.</p>

<h2 id="custom-events">Custom events</h2>

<p>It is possible to send custom events to the clients by adding the following code to your presentation or plugin.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">'send'</span><span class="p">);</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="p">{</span> <span class="na">sender</span><span class="p">:</span> <span class="s1">'someplugin'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'somecustomevent'</span> <span class="p">};</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span> <span class="nx">message</span> <span class="p">);</span>
</code></pre></div></div>
<p>The broadcast plugin will forward this event to all connected clients who can listen to custom events using the following code.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="s1">'received'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">message</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// only listen to events of the same sender</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span> <span class="o">&amp;&amp;</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="s1">'someplugin'</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">'somecustomevent'</span><span class="p">:</span>
        <span class="c1">// do something</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>
<p>Whenever a new client joins the broadcast the broadcast plugins sends a <code class="highlighter-rouge">newclient</code> event. You can react to the event, e.g., by broadcasting initialisation information to all clients.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="s1">'newclient'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// (re-)send initialisation info as new client has joined</span>
  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">'send'</span><span class="p">);</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="na">sender</span><span class="p">:</span> <span class="s1">'someplugin'</span><span class="p">,</span> 
     <span class="na">type</span><span class="p">:</span> <span class="s1">'init'</span><span class="p">,</span> 
     <span class="err">\\</span> <span class="p">...</span> 
  <span class="p">};</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span> <span class="nx">message</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>
<p>In the <a href="https://rajgoel.github.io/reveal.js-demos/broadcast-demo.html">demo</a> all drawings created with the <code class="highlighter-rouge">chalkboard.js</code> plugin are broadcasted to the clients. Checkout the source code of <code class="highlighter-rouge">chalkboard.js</code> plugin for an example of the implementation.</p>

<h2 id="license">License</h2>

<p>MIT licensed</p>

<p>Copyright (C) 2017 Asvin Goel</p>



    </body>
</html>